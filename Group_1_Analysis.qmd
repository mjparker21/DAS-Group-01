---
title: "An Analysis of Obesity Prevelance in Scotland (2013-2016)"
author: "Group 1 "
execute: 
  echo: false
  eval: true
number-sections: true
format:
  html:
    embed-resources: true
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false
library(AICcmodavg)
library(readr)
library(ggplot2)
library(ggfortify)
library(tidyverse)
library(tidymodels)
library(gt)
library(MASS)
library(patchwork)
library(moderndive)
library(stringr)
library(sjPlot)
library(knitr)
```

```{r}
#| echo: false
#| warning: false
#| message: false
obesity <- read.csv("DAProject3.csv")
```

# Introduction {#sec-intro}

Obesity is a serious public health concern. Obesity occurs when an individual's energy intake from food and drink is higher than the amount of energy needed over a period of time. Data has been gathered from the Scottish Health Surveys from 2013-2016. The data gathered includes the variable `Obese`, which indicates whether an individual classes themselves as obese, and the following other lifestyle and socio-economic factors:

-   `AgeGroup` - The age range of the individual.

-   `Sex` - The sex of an individual (Male or Female).

-   `Employment` - The individual's employment status.

-   `Veg` - Indicates whether the individual consumes the recommended daily intake of vegetables (Yes/No).

-   `Fruit` - Indicates whether the individual consumes the recommended daily intake of fruit (Yes/No).

-   `Year` - The year in which the Scottish Health Survey was conducted.

The main focus of this report will be to examine the prevalence of obesity in Scotland over the given years and to examine differences in obesity by age, sex and the other lifestyle and socio-economic factors.

@sec-exploranalysis consists of an exploratory analysis of the obesity data and explores the potential relationship between factors. @sec-formalanalysis contains the results from fitting a logistic regression model to the data, as well as the assessment of the model assumptions. Concluding remarks are given in @sec-conclusion.

# Exploratory Analysis {#sec-exploranalysis}

@fig-bar1 displays the relationship between variables `Obesity` and `Year` revealing the prevalence of obesity in Scotland over the given years of the Scottish Health Survey. From @fig-bar1, we can see that, on average, there was not much change in the recorded number of obese individuals in Scotland by year from 2013 to 2016. We observe a slightly smaller count in 2016 compared to the previous three years, but it appears that `Year` is not a significant explanatory variable.

The proportion of no obesity has remained way above the proportion for obesity over the given years.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar1
#| fig-cap: Relationship between Obesity and Year.
#| fig-align: center
#| fig-height: 3.5
ggplot(obesity, aes(x = Year, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")
```

In @fig-bar2 we observe the relationships between `Obesity` and `AgeGroup`, and `Obesity` and `Sex`. It is revealed that the obesity proportion is highest in the 55-64 age group and decreases as age decreases, as well as for an increase in age. The lowest obesity proportion is counted in the 16-24 age group.

We can also see in @fig-bar2 that obesity appears slightly higher in females than in males.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar2
#| fig-cap: Obesity by Age Group and Sex.
#| fig-align: center
#| fig-height: 3.5
obesity_sub <- obesity |> dplyr::filter(Obese=="Yes")

p1 <- ggplot(obesity_sub, aes(x = AgeGroup, group = Obese)) + 
      geom_bar(aes(y = after_stat(prop)), fill = "turquoise3", stat = "count", position = "dodge") +
      labs(y = "Proportion", fill = "Obese")

p2 <- ggplot(obesity, aes(x = Sex, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")


p1+p2+plot_layout(ncol = 2)
```

We also observe the relationship between `Obesity` and different lifestyle factors (whether or not the individual consumes the recommended daily intake of fruit or vegetables) in @fig-bar3. Obesity seems to be more prevalent in those who did consume the recommended daily intake of fruit or veg compared to those who didn't.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar3
#| fig-cap: Relationship between Obesity and Lifestyle Factors.
#| fig-align: center
#| fig-height: 3.5

# fruit
f <- ggplot(obesity, aes(x = Fruit, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")

# veg
v <- ggplot(obesity, aes(x = Veg, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")

f+v+plot_layout(ncol = 2)
```

Finally, the relationship between `Obesity` and `Employment` is revealed in @fig-bar4. The obesity proportion is clearly highest in employed individuals, followed by retirees, while the other factors appear to have very low proportions of obesity.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar4
#| fig-cap: Relationship between Obesity and Socio-economic Status. 
#| fig-align: center
#| fig-height: 3.5

ggplot(obesity_sub, aes(x = Employment, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), fill = "turquoise3", stat = "count", position = "dodge") +
  labs(y = "Proportion") +
  scale_x_discrete(labels = function(x) str_wrap(x, width = 10))

```

# Formal Analysis {#sec-formalanalysis}

```{r}
#| echo: false
#| warning: false
#| message: false
# change to factors
obesity$AgeGroup <- as.factor(obesity$AgeGroup)
obesity$Year <- as.factor(obesity$Year)
obesity$Sex <- as.factor(obesity$Sex)
obesity$Employment <- as.factor(obesity$Employment)
obesity$Veg <- as.factor(obesity$Veg)
obesity$Fruit <- as.factor(obesity$Fruit)
obesity$Obese <- as.factor(obesity$Obese)
```

To analyse the prevalence of obesity over the given years, we produce a logistic regression model for `Obesity` by `Year`. The large p-values shown in @fig-GLMyear match our assumptions from @fig-bar1: we can conclude that year has no significant effect on obesity in Scotland.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-GLMyear
#| fig-cap: GLM with Year as explanatory variable.
year.model <- glm(Obese ~ Year, data=obesity, family = "binomial")
coefficents.year <- year.model |> 
  summary() |> 
  coef()
knitr::kable(coefficents.year)
```

Now we go ahead and fit a model in order to explore further the relationship between obesity and our other variables. The `Year` and `Fruit` variables are not included in our initial fit of the model because from the exploratory analysis these variables do not appear to impact obesity. The `StepAIC` function from the `MASS` package is then used to fit the model with the lowest AIC.

```{r}
#| echo: false
#| warning: false
#| message: false
obesity.sub2 <- obesity |> dplyr::select(Obese,Veg,Sex,Employment,AgeGroup)
init.model <- glm(Obese~.^2, data = obesity.sub2, family = "binomial")
final.model <- stepAIC(init.model,direction = "both", trace = FALSE)
```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-GLMfull
#| fig-cap: Best fitting GLM model.
coefficents.final <- final.model |> 
  summary() |> 
  coef()
knitr::kable(coefficents.final)
```

From our model we can draw multiple conclusions.

# Conclusion {#sec-conclusion}
