---
title: "Analysis of Obesiety Prevelance in Scotland (2013-2016)"
author: "Group 1 "
execute: 
  echo: false
  eval: true
number-sections: true
format:
  html:
    embed-resources: true
editor_options: 
  chunk_output_type: console
---

```{r}
#| echo: false
#| warning: false
#| message: false
library(AICcmodavg)
library(readr)
library(ggplot2)
library(ggfortify)
library(tidyverse)
library(tidymodels)
library(gt)
library(MASS)
library(patchwork)
library(moderndive)
library(stringr)
```

```{r}
#| echo: false
#| warning: false
#| message: false
obesity <- read.csv("DAProject3.csv")
```

# Introduction {#intro}

# Exploratory Analysis {#exploranalysis}

@fig-bar1 displays the relationship between variables `Obesity` and `Year` revealing the prevalence of obesity in Scotland over the given years of the Scottish Health Survey. From @fig-bar1, we can see that, on average, there was not much change in the recorded number of obese individuals in Scotland by year from 2013 to 2016. We observe a slightly smaller count in 2016 compared to the previous three years, but it appears that `Year` is not a significant explanatory variable.

The count for no obesity has remained way above the count for obesity over the given years.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar1
#| fig-cap: Relationship between Obesity and Year.
#| fig-align: center
#| fig-height: 3.5
ggplot(obesity, aes(x = Year, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")
```

In @fig-bar2 we observe the relationships between `Obesity` and `AgeGroup`, and `Obesity` and `Sex`. It is revealed that the obesity count is highest in the 55-64 age group and decreases as age decreases, as well as for an increase in age. The lowest obesity number is counted in the 16-24 age group.

We can also see in @fig-bar2 that the obesity count appears slightly higher in females than in males.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar2
#| fig-cap: Obesity by Age Group and Sex.
#| fig-align: center
#| fig-height: 3.5
obesity_sub <- obesity |> dplyr::filter(Obese=="Yes")

p1 <- ggplot(obesity_sub, aes(x = AgeGroup, group = Obese)) + 
      geom_bar(aes(y = after_stat(prop)), fill = "turquoise3", stat = "count", position = "dodge") +
      labs(y = "Proportion", fill = "Obese")

p2 <- ggplot(obesity, aes(x = Sex, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")


p1+p2+plot_layout(ncol = 2)
```

We also observe the relationship between `Obesity` and different lifestyle factors (whether or not the individual consumes the recommended daily intake of fruit or vegetables) in @fig-bar3. Obesity seems to be more prevalent in those who did consume the recommended daily intake of fruit or veg compared to those who didn't.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar3
#| fig-cap: Relationship between Obesity and Lifestyle Factors.
#| fig-align: center
#| fig-height: 3.5

# fruit
f <- ggplot(obesity, aes(x = Fruit, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")

# veg
v <- ggplot(obesity, aes(x = Veg, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")

f+v+plot_layout(ncol = 2)
```

Finally, the relationship between `Obesity` and `Employment` is revealed in @fig-bar4. The obesity count is clearly highest in employed individuals, followed by retirees, while the other factors appear to have very low obesity counts.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-bar4
#| fig-cap: Relationship between Obesity and Socio-economic Status. 
#| fig-align: center
#| fig-height: 3.5

ggplot(obesity_sub, aes(x = Employment, group = Obese)) + 
  geom_bar(aes(y = after_stat(prop), fill = Obese), fill = "turquoise3", stat = "count", position = "dodge") +
  labs(y = "Proportion", fill = "Obese")
```

# Formal Analysis {#formalanalysis}

```{r}
#| echo: false
#| warning: false
#| message: false

# change to factors
obesity$AgeGroup <- as.factor(obesity$AgeGroup)
obesity$Year <- as.factor(obesity$Year)
obesity$Sex <- as.factor(obesity$Sex)
obesity$Employment <- as.factor(obesity$Employment)
obesity$Veg <- as.factor(obesity$Veg)
obesity$Fruit <- as.factor(obesity$Fruit)
obesity$Obese <- as.factor(obesity$Obese)
```

To answer our first question of interest, we produce a logistic regression model for `Obesity` by `Year`. The large p-values shown in @fig-GLMyear match our assumptions from @fig-bar1: we can conclude that year has no significant effect on obesity in Scotland.

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-GLMyear
#| fig-cap: GLM with Year as explanatory variable.

year.model <- glm(Obese ~ Year, data=obesity, family = "binomial")

coefficents.year <- year.model |> 
  summary() |> 
  coef()

knitr::kable(coefficents.year)

```

Through the comparison of multiple logistic regression models by stepwise regression using AIC, we find that the following model minimises the AIC:

```{r}
#| echo: false
#| warning: false
#| message: false 

# test interaction model AIC

full.model <- glm(Obese ~ Sex * Veg + AgeGroup * Veg + Employment * Veg + AgeGroup * Employment + AgeGroup * Sex + Sex * Employment, family = 'binomial', data = obesity)

full.model <- glm(Obese ~ .^2, data = obesity, family = 'binomial')

# stepAIC(full.model, direction = "both")


# final model according to AIC:

final.model <- glm(Obese ~ Veg + Sex * AgeGroup + Sex * Employment, family = 'binomial', data = obesity)

```

```{r}
#| echo: false
#| warning: false
#| message: false
#| label: fig-GLMfull
#| fig-cap: Best fitting GLM model.

coefficents.final <- final.model |> 
  summary() |> 
  coef()

knitr::kable(coefficents.final)
```


From our model we can draw multiple conclusions.

# Conclusion {#conclusion}
